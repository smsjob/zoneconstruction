<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Annoncer ‚Äî ZoneConstruction.ca</title>
  <meta name="description" content="Publiez une offre d‚Äôemploi en construction au Qu√©bec. Paiement s√©curis√© via Stripe, publication automatis√©e.">
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self';
                 img-src 'self' data: https:;
                 script-src 'self' 'unsafe-inline';
                 style-src 'self' 'unsafe-inline' https:;
                 connect-src 'self' https://script.google.com;
                 frame-ancestors 'none';
                 base-uri 'self'">

  <style>
    :root{--line:#eaeaea;--brand:#f9a533;--brand-2:#ffb84d;--text:#161616;--muted:#666;--bg:#fff}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:var(--bg);color:var(--text)}
    header{border-bottom:1px solid var(--line);background:#fff}
    nav{max-width:1100px;margin:0 auto;padding:14px 20px;display:flex;gap:22px}
    nav a{text-decoration:none;color:#111}
    nav a.active{border-bottom:3px solid #111}
    .wrap{max-width:900px;margin:0 auto;padding:20px}
    h1{margin:8px 0 14px}
    .notice{background:#fff3cd;border:1px solid #ffe69c;padding:10px;border-radius:8px;margin:8px 0}
    .section{margin:18px 0}
    .section h2{margin:0 0 10px;font-size:1.05rem;display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;border:1px solid var(--line);background:#fafafa}
    .card{border:1px solid var(--line);border-radius:14px;padding:18px;background:#fff;margin:12px 0;box-shadow:0 1px 0 rgba(0,0,0,.02),0 8px 24px rgba(0,0,0,.03)}
    label{font-weight:700;display:block;margin-bottom:6px}
    .muted{color:var(--muted);font-size:.9rem}
    .req::after{content:" *";color:#b00020}
    input,textarea,select{width:100%;padding:10px;border:1px solid var(--line);border-radius:10px;font:inherit;background:#fff}
    textarea{min-height:140px;resize:vertical}
    input:focus,textarea:focus,select:focus{outline:none;border-color:var(--brand);box-shadow:0 0 0 3px rgba(249,165,51,.25)}
    .grid{display:grid;gap:16px}
    .grid-2{grid-template-columns:repeat(2,minmax(0,1fr))}
    .chips{display:flex;flex-wrap:wrap;gap:10px}
    .chip{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--line);border-radius:999px;padding:8px 12px;background:#fff}
    .btn{display:inline-block;background:var(--brand);color:#111;border:none;border-radius:999px;padding:12px 16px;font-weight:700;text-decoration:none;cursor:pointer;transition:.15s background}
    .btn:hover{background:var(--brand-2)}
    .btn[disabled]{opacity:.6;cursor:default}
    footer{border-top:1px solid #ddd;margin-top:40px;padding:20px;text-align:center;font-size:0.9rem}
    .logo-preview{display:flex;align-items:center;gap:12px;margin-top:8px}
    .logo-preview img{max-height:48px;border-radius:8px;border:1px solid var(--line)}
    .hidden{display:none}
  </style>
</head>
<body>
  <header>
    <nav>
      <a href="index.html">Accueil</a>
      <a href="emplois.html">Emplois</a>
      <a class="active" href="annoncer.html">Annoncer</a>
      <a href="apropos.html">√Ä propos</a>
    </nav>
  </header>

  <div class="wrap">
    <h1>Publier une offre</h1>
    <p class="notice">Choisissez la cat√©gorie et r√©pondez √† la question CCQ. Les champs pertinents appara√Ætront selon votre choix.</p>

    <div class="card">
      <form id="jobForm" class="grid" novalidate>
        <!-- SECTION: Cat√©gorie g√©n√©rale + CCQ (toujours visibles au d√©part) -->
        <div class="section">
          <h2>üß≠ Cat√©gorie & CCQ</h2>
          <div class="grid grid-2">
            <!-- Cat√©gorie g√©n√©rale -->
            <div id="wrapCategorie">
              <label class="req" for="categorie">Cat√©gorie</label>
              <select id="categorie" name="Categorie" required>
                <option value="" disabled selected>‚Äî S√©lectionner ‚Äî</option>
                <option>Administration</option>
                <option>Vente</option>
                <option>Chantier</option>
              </select>
              <div class="muted">Pour les postes non CCQ. Si vous choisissez CCQ = Oui, des s√©lecteurs sp√©cialis√©s appara√Ætront.</div>
            </div>

            <!-- CCQ radios -->
            <div>
              <label class="req">Carte de comp√©tence CCQ requise ?</label>
              <div style="display:flex;gap:16px;margin-top:6px">
                <label><input type="radio" name="ccq_required" value="OUI"> Oui</label>
                <label><input type="radio" name="ccq_required" value="NON"> Non</label>
              </div>
            </div>
          </div>

          <!-- 4 s√©lecteurs CCQ ‚Äî visibles seulement si CCQ = OUI -->
          <div id="wrapMetier" class="section hidden">
            <label class="req" for="metier">M√©tier / Occupation</label>
            <select id="metier" name="Metier">
              <option value="" disabled selected>‚Äî S√©lectionner ‚Äî</option>
              <option>Arpenteur/Arpenteuse</option>
              <option>Boutefeu-foreur/Boutefeu-foreuse</option>
              <option>Briqueteur-ma√ßon/Briqueteuse-ma√ßonne</option>
              <option>Calorifugeur/Calorifugeuse</option>
              <option>Carreleur/Carreleuse</option>
              <option>Charpentier-menuisier/Charpenti√®re-menuisi√®re</option>
              <option>Chaudronnier/Chaudronni√®re</option>
              <option>Cimentier-applicateur/Cimenti√®re-applicatrice</option>
              <option>Couvreur/Couvreuse</option>
              <option>√âlectricien/√âlectricienne</option>
              <option>√âlectricien/√âlectricienne en installation de syst√®mes de s√©curit√©</option>
              <option>Ferblantier/Ferblanti√®re</option>
              <option>Ferrailleur/Ferrailleuse</option>
              <option>Frigoriste</option>
              <option>Grutier/Gruti√®re</option>
              <option>M√©canicien/M√©canicienne d'ascenseur</option>
              <option>M√©canicien/M√©canicienne industriel(le)de chantier</option>
              <option>M√©canicien/M√©canicienne de machines lourdes</option>
              <option>M√©canicien/M√©canicienne en protection-incendie</option>
              <option>Monteur-assembleur/Monteuse-assembleuse</option>
              <option>Monteur-m√©canicien (vitrier)/Monteuse-m√©canicienne (vitri√®re)</option>
              <option>Monteur/Monteuse de lignes</option>
              <option>Op√©rateur/Op√©ratrice d'√©quipement lourd</option>
              <option>Op√©rateur/Op√©ratrice de pelles m√©caniques</option>
              <option>Peintre</option>
              <option>Pl√¢trier/Pl√¢tri√®re</option>
              <option>Poseur/Poseuse de rev√™tements souples</option>
              <option>Poseur/Poseuse de syst√®mes int√©rieurs</option>
              <option>Scaphandrier/Scaphandri√®re</option>
              <option>Soudeur/Soudeuse</option>
              <option>Soudeur/Soudeuse en tuyauterie (haute pression)</option>
              <option>Tuyauteur/Tuyauteuse</option>
            </select>
          </div>

          <div id="wrapNiveau" class="section hidden">
            <label class="req" for="niveau">Niveau</label>
            <select id="niveau" name="Niveau">
              <option value="" disabled selected>‚Äî S√©lectionner ‚Äî</option>
              <option>Compagnon</option>
              <option>Apprenti</option>
              <option>Occupation</option>
            </select>
          </div>

          <div id="wrapSecteur" class="section hidden">
            <label class="req" for="secteur">Secteur</label>
            <select id="secteur" name="Secteur">
              <option value="" disabled selected>‚Äî S√©lectionner ‚Äî</option>
              <option>G√©nie Civil et Voirie</option>
              <option>Industriel</option>
              <option>Institutionnel et Commercial</option>
              <option>R√©sidentiel</option>
            </select>
          </div>

          <div id="wrapRegion" class="section hidden">
            <label class="req" for="region">R√©gion</label>
            <select id="region" name="Region">
              <option value="" disabled selected>‚Äî S√©lectionner ‚Äî</option>
              <option>01 √éles-de-la-Madeleine</option>
              <option>02 Bas-Saint-Laurent‚ÄìGasp√©sie</option>
              <option>03 Saguenay‚ÄìLac-Saint-Jean</option>
              <option>04 Qu√©bec</option>
              <option>06 Mauricie‚ÄìBois-Francs</option>
              <option>07 Estrie</option>
              <option>08 Grand Montr√©al</option>
              <option>09 Outaouais</option>
              <option>10 Abitibi-T√©miscamingue</option>
              <option>11 C√¥te-Nord</option>
              <option>13 Baie-James</option>
              <option>14 Nunavik</option>
            </select>
          </div>
        </div>

        <!-- SECTION: D√©tails du poste -->
        <div class="section">
          <h2>üìù D√©tails du poste</h2>

          <!-- Titre & Salaire ‚Äî visibles seulement si CCQ = NON -->
          <div id="wrapTitle" class="hidden">
            <label class="req" for="titre">Titre du poste</label>
            <input id="titre" name="Job Title" placeholder="Ex: Charpentier-menuisier, Adjoint administratif" />
          </div>

          <div>
            <label class="req" for="description">Description</label>
            <textarea id="description" name="Job Description" required></textarea>
          </div>

          <div class="grid grid-2">
            <div>
              <label class="req" for="horaire">Horaire</label>
              <select id="horaire" name="Employment Type" required>
                <option value="" disabled selected>‚Äî S√©lectionner ‚Äî</option>
                <option>Temps-Plein</option>
                <option>Temps-Partiel</option>
                <option>Contractuel</option>
                <option>Rotation Fly-in Fly-out</option>
                <option>Horaire vari√©</option>
                <option>Travail √† distance</option>
                <option>Ind√©pendant</option>
                <option>Autre arrangement</option>
              </select>
            </div>

            <div id="wrapSalaire" class="hidden">
              <label for="salaire">Salaire</label>
              <input id="salaire" name="Salary Display" placeholder="ex: entre 35$ et 40$ de l'heure" />
              <div class="muted">Affich√© aussi sur la fiche (Google Jobs).</div>
            </div>
          </div>
        </div>

        <!-- SECTION: Localisation -->
        <div class="section">
          <h2>üìç Localisation</h2>
          <div class="grid grid-2">
            <div>
              <label class="req" for="street">Num√©ro et rue</label>
              <input id="street" name="Street Address" required />
            </div>
            <div>
              <label class="req" for="city">Ville</label>
              <input id="city" name="City" required />
            </div>
          </div>
          <div class="grid grid-2">
            <div>
              <label class="req" for="postal">Code postal</label>
              <input id="postal" name="Postal Code" required placeholder="H2X 1Y4" pattern="[A-Za-z]\d[A-Za-z][ -]?\d[A-Za-z]\d" title="Format A1A 1A1" />
            </div>
            <div>
              <label class="req" for="prov">Province</label>
              <input id="prov" name="addressRegion" required value="QC" />
            </div>
          </div>
          <div>
            <label class="req" for="country">Pays</label>
            <input id="country" name="Country" required value="Canada" />
          </div>
        </div>

        <!-- SECTION: Entreprise & contact -->
        <div class="section">
          <h2>üè¢ Entreprise & contact</h2>
          <div>
            <label class="req" for="company">Nom de l'entreprise</label>
            <input id="company" name="Company Name" required />
          </div>

          <div>
            <label for="logo">Logo de l'entreprise</label>
            <input id="logo" type="file" name="Logo File" accept="image/*" />
            <div id="logoPreview" class="logo-preview hidden">
              <img id="logoImg" alt="Logo preview" />
              <button id="logoClear" type="button" class="btn" style="padding:6px 10px">Retirer</button>
            </div>
            <div class="muted">PNG/JPG (facultatif). Un aper√ßu s‚Äôaffichera apr√®s s√©lection.</div>
          </div>

          <div class="grid grid-2">
            <div>
              <label class="req" for="email">Courriel de communication</label>
              <input id="email" type="email" name="email" required placeholder="contact@entreprise.com" />
            </div>
            <div>
              <label for="phone">T√©l√©phone</label>
              <input id="phone" name="Phone" placeholder="514-123-4567" />
            </div>
          </div>
          <div>
            <label for="website">Site Web</label>
            <input id="website" name="Company Website" placeholder="https://..." />
          </div>
        </div>

        <!-- SECTION: Candidatures -->
        <div class="section">
          <h2>‚úÖ Comment postuler</h2>
          <div class="chips">
            <label class="chip"><input type="checkbox" name="apply_methods" value="Courriel" /> Courriel</label>
            <label class="chip"><input type="checkbox" name="apply_methods" value="En personne" /> En personne</label>
            <label class="chip"><input type="checkbox" name="apply_methods" value="T√©l√©phone/SMS" /> T√©l√©phone / SMS</label>
            <label class="chip"><input type="checkbox" name="apply_methods" value="Site Web" /> Site Web</label>
          </div>
          <div class="muted" style="margin-top:6px">Vous pouvez choisir plusieurs options.</div>
        </div>

        <!-- Honeypot anti-bot -->
        <input type="text" name="website_hp" autocomplete="off" tabindex="-1" style="position:absolute;left:-9999px;top:-9999px" aria-hidden="true">

        <!-- TECH -->
        <input type="hidden" name="allow_geocode" value="1">
        <button class="btn" id="submitBtn" type="submit">Continuer au paiement</button>
      </form>
    </div>
  </div>

  <footer>
    <p>&copy; 2025 ZoneConstruction.ca |
      <a href="politique.html">Politique de confidentialit√©</a> |
      <a href="conditions.html">Conditions d‚Äôutilisation</a>
    </p>
  </footer>

  <script>
    const API = 'https://script.google.com/macros/s/AKfycbyJ5_OeEPlq4z-2QPaP2IzRBRtz1Gs-p0uMxhNoZBx2jeKbclovTCKb-F1twt0xXZEzdA/exec';

    const addHidden = el => el.classList.add('hidden');
    const remHidden = el => el.classList.remove('hidden');
    const isHidden  = el => !el || el.classList.contains('hidden') || el.offsetParent === null;

    // CCQ radios
    const radiosCcq  = document.querySelectorAll('input[name="ccq_required"]');

    // General category
    const wrapCategorie = document.getElementById('wrapCategorie');
    const categorie     = document.getElementById('categorie');

    // CCQ groups
    const wrapMetier  = document.getElementById('wrapMetier');
    const wrapNiveau  = document.getElementById('wrapNiveau');
    const wrapSecteur = document.getElementById('wrapSecteur');
    const wrapRegion  = document.getElementById('wrapRegion');
    const metier  = document.getElementById('metier');
    const niveau  = document.getElementById('niveau');
    const secteur = document.getElementById('secteur');
    const region  = document.getElementById('region');

    // Title/Salary blocks
    const wrapTitle   = document.getElementById('wrapTitle');
    const wrapSalaire = document.getElementById('wrapSalaire');
    const titre   = document.getElementById('titre');
    const salaire = document.getElementById('salaire');

    function updateCcqUI(){
      const selected = document.querySelector('input[name="ccq_required"]:checked');
      const ccqOui = selected && selected.value === 'OUI';

      if (ccqOui){
        // Hide general category; show CCQ selects; hide title/salary
        addHidden(wrapCategorie);
        if (categorie){ categorie.removeAttribute('required'); categorie.selectedIndex = 0; }

        [wrapMetier,wrapNiveau,wrapSecteur,wrapRegion].forEach(remHidden);
        [metier,niveau,secteur,region].forEach(el => el?.setAttribute('required','required'));

        addHidden(wrapTitle); addHidden(wrapSalaire);
        titre?.removeAttribute('required');
      } else {
        // Non or nothing selected yet ‚Üí show general category; hide CCQ selects
        remHidden(wrapCategorie);
        categorie?.setAttribute('required','required');

        [wrapMetier,wrapNiveau,wrapSecteur,wrapRegion].forEach(addHidden);
        [metier,niveau,secteur,region].forEach(el => { if(el){ el.removeAttribute('required'); el.selectedIndex = 0; } });

        // If explicitly NON, show title/salary; if nothing chosen, keep them hidden until submit
        if (selected && selected.value === 'NON'){
          remHidden(wrapTitle); remHidden(wrapSalaire);
          titre?.setAttribute('required','required');
        } else {
          addHidden(wrapTitle); addHidden(wrapSalaire);
          titre?.removeAttribute('required');
        }
      }
    }

    radiosCcq.forEach(r => r.addEventListener('change', updateCcqUI));
    document.addEventListener('DOMContentLoaded', updateCcqUI);

    // Logo preview
    const logoInput = document.getElementById('logo');
    const logoPreview = document.getElementById('logoPreview');
    const logoImg = document.getElementById('logoImg');
    const logoClear = document.getElementById('logoClear');

    if (logoInput){
      logoInput.addEventListener('change', ()=>{
        const file = logoInput.files?.[0];
        if(file){
          const url = URL.createObjectURL(file);
          logoImg.src = url;
          remHidden(logoPreview);
        }else{
          addHidden(logoPreview);
          logoImg.removeAttribute('src');
        }
      });
    }
    if (logoClear){
      logoClear.addEventListener('click', ()=>{
        logoInput.value = '';
        logoImg.removeAttribute('src');
        addHidden(logoPreview);
      });
    }

    // Submit
    const form = document.getElementById('jobForm');
    const submitBtn = document.getElementById('submitBtn');

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();

      // Validate visible required fields
      const requiredFields = [...form.querySelectorAll('[required]')]
        .filter(el => !isHidden(el) && !isHidden(el.closest('.section')) && !isHidden(el.closest('div')));

      for(const el of requiredFields){
        if(!String(el.value||'').trim()){
          alert('Veuillez remplir tous les champs requis (*)');
          el.focus();
          return;
        }
      }

      // Honeypot
      const hp = form.querySelector('input[name="website_hp"]');
      if (hp && hp.value) { alert('Requ√™te bloqu√©e.'); return; }

      // Apply methods
      const methods = [...document.querySelectorAll('input[name="apply_methods"]:checked')].map(i=>i.value);

      const fd = new FormData(form);
      fd.append('Apply Methods', methods.join(', '));
      fd.append('action','create_session'); // server decides the price

      // Save for merci.html
      const plain = Object.fromEntries(fd.entries());
      sessionStorage.setItem('jobForm', JSON.stringify(plain));

      submitBtn.disabled = true;

      try{
        const res = await fetch(API, { method:'POST', body:fd, cache:'no-store' });
        if (!res.ok) throw new Error('API indisponible');
        const j = await res.json();
        if(j.ok && j.url){
          location.href = j.url; // ‚Üí Stripe Checkout
        }else{
          alert('Erreur: ' + (j.error || 'cr√©ation paiement'));
          submitBtn.disabled = false;
        }
      }catch(err){
        alert('Erreur r√©seau: ' + err.message);
        submitBtn.disabled = false;
      }
    });
  </script>
</body>
</html>



